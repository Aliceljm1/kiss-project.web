/* ajax manager */
function handleException(result) {
	if (result == null || !result.__AjaxException)
		return result;

	var exc = result.__AjaxException;
	if (exc.action == "JSMethod") {
		result = null;
		eval(exc.parameter + "()");
	}
	else if (exc.action == "JSEval") {
		result = null;
		eval(exc.parameter);
	}
	else if (exc.action == "returnValue") {
		return exc.parameter;
	}
}

function AjaxManager() { }

AjaxManager.prototype = {
	initialize: function () { },
	getData: function (classId, methodName, args, ajaxType, callbackMethod, ajaxUrl) {
		var result = null;
		var asyncCall = false;
		if (callbackMethod && typeof callbackMethod == "function") {
			asyncCall = true;
		}

		$.ajax({
			type: ajaxType || 'Post',
			url: ajaxUrl || "/ajax.aspx",
			async: asyncCall,
			dataType: 'json',
			data: "classId=" + encodeURIComponent(classId) +
						"&methodName=" + encodeURIComponent(methodName) +
						"&methodArgs=" + encodeURIComponent(JSON.stringify(args)) +
						"&querystring=" + encodeURIComponent(window.location.search),
			success: function (e) {
				result = handleException(e);		
				
				if (callbackMethod && result != undefined) {
					callbackMethod(result);
				}
			},
			error: function (e) {				
				result = handleException(e);
				if(!result) {
					result = e.responseText;
				}
				if (callbackMethod && result != undefined) {
					callbackMethod(result);
				}
			}
		});
		return result;
	}
};
var __ajaxManager = new AjaxManager();